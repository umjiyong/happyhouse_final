<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.ssafy.happyhouse.model.dao.HouseDao">

	
<!-- 
	public List<HouseDeal> searchHouseDealByDong(String dongCode) throws SQLException;
	public List<HouseDeal> searchHouseDealByName(String aptName) throws SQLException;
	public List<HouseDeal> searchAll() throws SQLException;
	public List<HouseDeal> searchFavorite(String userId) throws SQLException;
	
	public List<HouseInfo> searchHouseInfo(String aptCode) throws SQLException;
	
	

 -->
 <!-- 
 		WHERE dongCode in (
							SELECT dongCode 
							FROM baseaddress
							WHERE 
								sidoName like CONCAT('%',#{sidoName},'%')
								AND gugunName like CONCAT('%',#{gugunName},'%')
								AND dongName like CONCAT('%',#{dongName},'%')		
							)
  -->
	<sql id="orderbydate_desc">
		ORDER BY dealYear DESC, dealMonth DESC, dealDay DESC
	</sql>
 
	<select id="searchHouseDealByDong" parameterType="map" resultType="HouseDeal">
		SELECT housedeal.*, aptName, buildYear, CONCAT(sidoName,' ',gugunName,' ',dongcode.dongName) as address, lat, lng
		FROM (housedeal INNER JOIN houseInfo using (aptCode)) INNER JOIN dongcode using (dongCode)
		WHERE dongCode=#{dongCode}
		<include refid="orderbydate_desc"/>
		limit 1, 10;
	</select>
	

    <update id="countView" parameterType="string">
		UPDATE baseaddress SET view = view + 1
		WHERE dongCode=#{dongCode}
    </update>
	
	<select id="searchHouseDealByGugun" parameterType="map" resultType="HouseDeal">
		SELECT housedeal.*, aptName, buildYear, CONCAT(sidoName,' ',gugunName,' ',dongcode.dongName) as address, lat, lng
		FROM (housedeal INNER JOIN houseInfo using (aptCode)) INNER JOIN dongcode using (dongCode)
		WHERE dongCode in(SELECT dongCode FROM dongcode WHERE sidoName=(SELECT sidoName FROM sidocode WHERE sidoCode=#{sidoCode}) AND gugunName=(SELECT gugunName FROM guguncode WHERE gugunCode=#{gugunCode}))
		<include refid="orderbydate_desc"/>
		limit 1, 10
	</select>
	
	<select id="searchHouseDealByName" parameterType="map" resultType="HouseDeal">
		SELECT housedeal.*, aptName, buildYear, CONCAT(sidoName,' ',gugunName,' ',dongcode.dongName) as address, lat, lng
		FROM (housedeal INNER JOIN houseInfo using (aptCode)) INNER JOIN dongcode using (dongCode)
		WHERE aptName like CONCAT('%',#{aptName},'%') 
		<include refid="orderbydate_desc"/>
		limit 1, 10
	</select>
	
	<select id="searchAll" resultType="HouseDeal">
		SELECT housedeal.*, aptName, buildYear, CONCAT(sidoName,' ',gugunName,' ',dongcode.dongName) as address
		FROM (housedeal INNER JOIN houseInfo using (aptCode)) INNER JOIN dongcode using (dongCode)
		<include refid="orderbydate_desc"/>
		limit 1, 10 
	</select>
	
	<select id="searchView" resultType="HouseDeal">
		SELECT view, CONCAT(sidoName,' ',gugunName,' ',dongName) as address
		FROM baseaddress
	</select>
	
	<select id="searchHouseInfo"></select>
 
 
 
<!-- 
	public List<Housedeal> searchbydong(String sidoName, String gugunName, String dongName) throws SQLException {

			con = DButil.getConnection();
			stmt = con.prepareStatement("select housedeal.*, aptName, buildYear, dongName\n"
					+ "from housedeal\n"
					+ "inner join houseinfo hi\n"
					+ "using (aptCode)\n"
					+ "where dongCode in (select dongCode from baseaddress where sidoName like ? and gugunName like ? and dongName like ?)\n"
					+ "limit 1, 10");
			
			
 -->
 
 
 <!-- 
 	public List<Housedeal> searchbyapt(String aptName) throws SQLException {

			con = DButil.getConnection();
			stmt = con.prepareStatement("select housedeal.*, aptName, buildYear, dongName "
					+ "from housedeal "
					+ "inner join houseinfo hi "
					+ "using (aptCode) "
					+ "where aptName like ? "
					+ "limit 1, 10 ");
  -->
  
  
  
  <!-- 
  	public List<Housedeal> searchAll() throws SQLException {

			con = DButil.getConnection();
			stmt = con.prepareStatement("select housedeal.*, aptName, buildYear, dongName "
					+ "from housedeal "
					+ "inner join houseinfo hi "
					+ "using (aptCode) "
					+ "limit 1, 10 ");
  
  
   -->
   
   <!-- 
   
	public List<Housedeal> searchFavorite(String user_id) throws SQLException {
    -->


</mapper>